<chapter xml:id="svn-install"
   xmlns="http://docbook.org/ns/docbook"
   xmlns:xl="http://www.w3.org/1999/xlink"
   xmlns:xi="http://www.w3.org/2003/XInclude">
  
  <title>Installation from Subversion</title>
  
  <para>
    Distribution (stable and continuous) are available from the
    download page at the Stratego/XT website. It is also possible to
    obtain the sources directly from Subversion. This is only useful
    if you want to modify the sources of Stratego/XT and might want to
    commit your changes.
  </para>

  <section>
    <title>Requirements</title>

    <para>
      Installation from Subversion requires some packages from the GNU
      build system. You need:
    </para>

    <itemizedlist>
      <listitem>
	<para>Autoconf 2.58 or newer (2.57 will not do)</para>
      </listitem>
      <listitem>
	<para>Automake 1.7.9 or newer. Very recent versions (1.9.x) are
	recommended and required if you want to create a distribution</para>
      </listitem>
      <listitem>
	<para>Libtool 1.5 or newer</para>
      </listitem>
      <listitem>
	<para>pkg-config 0.15 or newer</para>
      </listitem>
    </itemizedlist>

    <para>
      Unfortunately, many Linux distributions contain old versions of
      these packages, so please check te versions that are installed
      on your system. Also, check that libtool is installed at the
      same location (prefix) as Automake, otherwise
      <command>aclocal</command> will not be able to find the Autoconf
      macros of Libtool (<filename>libtool.m4</filename>)
    </para>

    <para>
      You now need a baseline installation of Stratego/XT to install
      Stratego/XT from Subversion. The latest baseline is always
      available at the <link
      xl:href="ftp://ftp.stratego-language.org/pub/stratego/StrategoXT/baseline/latest/strategoxt.tar.gz">ftp
      server</link> of Stratego. The need for a baseline is explained
      in <xref linkend="baseline"/>. For the installation of the
      baseline, you can follow the ordinary installation instructions
      for end-users (<xref linkend="installation"/>).
    </para>
  </section>

  <section>
    <title>How to checkout</title>

    <para>
      The Stratego/XT sources are kept in a source repository managed by 
      Subversion. Before checking out, you need to install recent Subversion
      release. After you have done so, you may do a checkout using the following
      command:
    </para>

<screen>
  $ svn checkout https://svn.cs.uu.nl:12443/repos/StrategoXT/trunk/StrategoXT/
</screen>

    <para>
      Note that your Subversion client has to support SSL
      support. Install Subversion <option>--with-ssl</option>.
    </para>
  </section>

  <section>
    <title>How to install</title>

    <para>
      To bring the source tree into a state where you can follow the
      end-user installation instructions you must run the
      <command>bootstrap</command> script. (see <xref
      linkend="bootstrap"/>).
    </para>
        	
<screen>
  $ ./bootstrap
</screen>

    <para>
      Note that on many distributions, the older versions of automake
      and autoconf are invoked by default.  You can check which
      version is invoked by issuing <command>automake
      --version</command> and <command>autoconf --version</command>.
      Unfortunately, the mechanism for switching to a newer version is
      distribution-specific. We automatically figure this out for some
      distributions. Look inside the boostrap for details, adjust and
      provide us with a patch, if your distribution is not supported.
    </para>

    <para>
      Now you can proceed with the installation instructions for a
      Stratego/XT distribution, with one exception: you must configure
      Stratego/XT with your baseline installation:
      <option>--with-strategoxt=<replaceable>$baselineprefix</replaceable></option>.
      <xref linkend="baseline"/> explains why and how we use a
      baseline.
    </para>
  </section>

  <section>
    <title>Subversion Repoman</title>

    <para>
      The repoman for gives an overview of possible ways to view the
      sources the StrategoXT repository:
    </para>

    <screen>https://svn.cs.uu.nl:12443/repoman/info/StrategoXT</screen>
  </section>

  <section>
    <title>Autoconf Macros: aclocal, libtool, and autoconf</title>
    
    <para>
      GNU Autoconf needs definitions of macros that are used in
      <filename>configure.ac</filename> files. GNU Automake contains
      the tool <command>aclocal</command>, which installs all
      requires macros. <command>aclocal</command> gets these macros
      from a directory with m4 files. <command>aclocal
      --print-ac-dir</command> reports this directory. Your libtool
      installation must install the <command>libtool.m4</command>
      file in the <filename>ac-dir</filename>. If this is not the
      case, you will see a non-fatal error like this:
    </para>
    
<screen>
configure.in:9: error: possibly undefined macro: AC_PROG_LIBTOOL
       If this token and others are legitimate, please use m4_pattern_allow.
       See the Autoconf documentation.
</screen>

<para>
  Later on in the build proces a missing =Makefile.in= will be
  reported, after which the build terminates.
</para>

<para>
  Usually the file <filename>libtool.m4</filename> is installed in the
  right directory if you install Libtool and Automake at the same
  prefix. However, when using recent, non-standard, ports of these
  packages on a FreeBSD systems (and probably also some RPM based
  systems), this does not happen. If <filename>libtool.m4</filename>
  is not in the right directory for some reason, then you must copy
  the <filename>libtool.m4</filename> file by hand into the
  <filename>ac-dir</filename>.
</para>
  </section>
</chapter>
