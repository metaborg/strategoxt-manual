<chapter xml:id="stratego-building"
  xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2003/XInclude">
  
  <title>Building and Deploying Stratego Programs (*)</title>
  
  <para>
    The Stratego build system is based on the GNU autotools, that is
    to say, automake, autoconf and libtool. In addition, we have a
    tool called autoxt. If you are familiar with the autotools, setting
    a project for Stratego should be rather easy. If this is unfamiliar
    ground to you, don't fear. We will walk through it slowly in
    this chapter.
  </para>

  <section>
    <title>Setting up your Project</title>
    
    <para>
      After creating your project directory, let's call it 
      <filename>ogetarts</filename>, the first thing you should do
      is populate it with the basic build system files, namely
      <filename>configure.ac</filename>, <filename>project.spec.in</filename>,
      <filename>bootstrap</filename> and <filename>Makefile.am</filename>.
      Additionally, you may want to add <filename>ChangeLog</filename>,
      <filename>AUTHORS</filename>, <filename>NEWS</filename> and
      <filename>README</filename>, but these are not essential.
      We will walk through the contents of each of the build system
      configuration files
    </para>

<screen><xi:include href="config/bootstrap.txt" parse="text"/></screen>

  <para>
    Explain bootstrap.txt
  </para>
  
<screen><xi:include href="config/src-makefile-am.txt" parse="text"/></screen>

  <para>
    Explain Makefile.am
  </para>
  
<screen><xi:include href="config/spec-in.txt" parse="text"/></screen>
  
  <para>
    Explain the project.spec.in
  </para>  
  
    <para>
      For a normal Stratego project, with XTC components, and some stand-alone
      applications, we suggest the project layout given below. Directories end
      in <filename>/</filename>. We will discuss the 
      <filename>Makefile.am</filename> files for the 
      <filename>src/</filename> hierarchy below.
    </para>
    
<screen>
  bootstrap
  configure.ac
  Makefile.am
  syn/
      Makefile.am
  sig/
      Makefile.am
  src/
      Makefile.am      
  src/xtc/
          Makefile.am
  src/lib/
          Makefile.am
  test/
  doc/
</screen>
  </section>
  
  <section>
    <title>Building Stand-alone Applications</title>

    <para>
      Building parse tables
    </para>

<screen><xi:include href="config/syn-makefile-am.txt" parse="text"/></screen>

    <para>
      Building signatures
    </para>

<screen><xi:include href="config/sig-makefile-am.txt" parse="text"/></screen>
    
    <para>
      Building Stratego programs; <code>bin_PROGRAMS</code> in 
      <filename>Makefile.am</filename>.
    </para>

<screen><xi:include href="config/src2-makefile-am.txt" parse="text"/></screen>
    
  </section>
  
  <section>
    <title>Building XTC components</title>
    
    <para>
    </para>
<screen><xi:include href="config/xtc-makefile-am.txt" parse="text"/></screen>

  </section>
</chapter>
