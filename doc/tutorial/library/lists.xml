<chapter
   xmlns="http://docbook.org/ns/docbook"
   xmlns:xi="http://www.w3.org/2003/XInclude">

  <title>Lists</title>
  
  <section>
  
  <title>Making heads and tails of it</title>

  <para>
    Lists in Stratego are nothing magical, except perhaps for some convenient
    syntactic sugar. As we know, lists are written 
    <code>[1,2,3]</code>, but this is just sugar for the term
    <code>Cons(1,Cons(2,Cons(3,Nil)))</code>. Assume <code>xs</code> is this list.
    The code <code>[0|xs]</code> will prepend a 0 to it, yielding [0,1,2,3]. Conversely, 
    <code>![0,1,2,3] ; ?[y|ys]</code> will bind <code>y</code> to
    the head of the list, <code>0</code>, and <code>ys</code> to the
    tail of the list, <code>[1,2,3]</code>.
  </para>

  <para>
    There are also a few other convenience functions worth mentioning.
    The strategy <code>elem</code> will check if a given value is in
    a list. If it is, the identity of the list will be returned:
  </para>
<screen>
stratego> &lt;elem> (1, [2,3,1,4])
[2,3,1,4]
</screen>
    
  <para>
    The following should speak for themselves:
  </para>
<screen>
stratego> &lt;length> [1,2,3,4,5]
5
stratego> &lt;last> [5,6,7,8,9]
9
stratego> &lt;reverse> [1,2,3,4,5]
[5,4,3,2,1]
stratego> &lt;map(inc)> [1,2,3,4]
[2,3,4,5]
stratego> &lt;filter(?2)> [1,2,3,2]
[2,2]
</screen>

  <para>
    There are two ways of concatenating lists. If the lists are
    given as a tuple, use <code>conc</code>. If you have a list
    of lists, use <code>concat</code>:
  </para>
<screen>
stratego> &lt;conc> ([1,2,3],[4,5,6],[7,8,9])
[1,2,3,4,5,6,7,8,9]
stratego> &lt;concat> [[1,2,3],[4,5,6],[7,8,9]]
[1,2,3,4,5,6,7,8,9]
</screen>

  <para>
	The sublist of the first <emphasis>n</emphasis> elements can be
	picked out with the <code>take(|n)</code> strategy:
  </para>
<screen>
stratego> &lt;take(|3)> [1,2,3,4,5]
[1,2,3]
</screen>  

  <para>
    Finally, the <code>fetch(s)</code> strategy can be used to find
    the first element for which <code>s</code> succeeds:
  </para>
<screen>
stratego> &lt;fetch(?2)> [1,2,3]
2
</screen>  

  <para>
    The Stratego library contains many other convenient functions,
    which are documented in the API documentation.
  </para>

  </section>
  
  <section>
  <title>
    Associative lists
  </title>

  <para>
    Stratego also has library support for associative lists, sometimes known
    as assoc lists. There are essentially lists of <code>(key, value)</code>
    pairs, and work like a poor man's hash table. The primary strategy for
    working with these lists is <code>lookup</code>. This strategy looks up
    the first value associated with a particular key, and returns it.
  </para>

<screen>
stratego> &lt;lookup> (2, [(1, "a"), (2, "b"), (3, "c")]) => "b"
</screen>

  </section>

  <section>
  <title>  
    Sets
  </title>
  <para>
    In Stratego, sets are implemented as lists. A set differs from a
    list in that a given element (value) can only occur once. The
    strategy <code>nub</code> (also known as <code>make-set</code>)
    can be use to make a list into a set. It will remove duplicate
    elements. The normal functions on sets are provided, among
    them union, intersection, difference and equality:
  </para>
<screen>
stratego> &lt;nub> [1,1,2,2,3,4,5,6,6]
[1,2,3,4,5,6]
stratego> &lt;union> ([1,2,3],[3,4,5])
[1,2,3,4,5]
stratego> &lt;diff> ([1,2,3],[3,4,5])
[1,2]
stratego> &lt;isect> ([1,2,3],[3,4,5])
[3]
stratego> &lt;set-eq> ([1,2,3],[1,2,3])
([1,2,3],[1,2,3])
</screen>
  </section>
  
  <section>
  <title>
    Zipping, joining
  </title>
  <para>
    There are also strategies for combining multiple lists in various
    non-trivial fashions, such as taking the cartesian product of
    lists, zipping lists (pairing two lists) and unzipping:
  </para>
<screen>
stratego> &lt;zip> ([1,2,3],[4,5,6])
[(1,4),(2,5),(3,6)]
stratego> unzip
([1,2,3],[4,5,6])
stratego> &lt;cart(id)> ([1,2,3],[4,5,6])
[(1,4),(1,5),(1,6),(2,4),(2,5),(2,6),(3,4),(3,5),(3,6)]
stratego> &lt;cart(add)> ([1,2,3],[4,5,6])
[5,6,7,6,7,8,7,8,9]
stratego> &lt;join(add)> ([1,2,3],[4,5,6])
[5,6,7,8,9]
</screen>  
  </section>
</chapter>

